<!DOCTYPE html>
<html lang="ko">
<head>
  <link rel="icon" type="image/png" href="studyplanner-removebg-preview.png">
  <meta charset="UTF-8" />
  <title>스터디 플래너</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      background: #f3f4f6;
    }

    .app {
      max-width: 1200px;
      margin: 20px auto;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
      padding: 16px 16px 24px;
    }

    .app-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .app-subtitle {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 16px;
    }

    .header-row {
      display: grid;
      grid-template-columns: 80px repeat(7, 1fr);
      gap: 4px;
      align-items: stretch;
      margin-bottom: 4px;
    }

    .time-label-header {
      text-align: center;
      font-weight: 600;
      font-size: 13px;
      padding: 8px 4px;
      color: #374151;
    }

    .day-header {
      position: relative;
      padding: 6px 6px 8px;
      border-radius: 10px 10px 0 0;
      color: #111827;
      font-weight: 600;
      font-size: 13px;
      min-height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .day-header-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      gap: 4px;
    }

    .day-center {
      flex: 1;
      text-align: center;
      line-height: 1.2;
    }

    .day-center .label {
      font-size: 14px;
      margin-bottom: 2px;
    }

    .day-center .date {
      font-size: 11px;
      opacity: 0.9;
    }

    .day-header button {
      border: none;
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 11px;
      cursor: pointer;
      background: rgba(255, 255, 255, 0.9);
      color: #111827;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
      white-space: nowrap;
    }

    .day-header button:hover {
      background: #ffffff;
      transform: translateY(-1px);
    }

    .btn-clear {
      background: rgba(248, 250, 252, 0.9);
      color: #b91c1c;
    }

    /* 무지개 색 요일 */
    .rainbow-0 { background: linear-gradient(135deg, #fecaca, #f97373); }  /* 월 - 빨강 */
    .rainbow-1 { background: linear-gradient(135deg, #fed7aa, #fb923c); }  /* 화 - 주황 */
    .rainbow-2 { background: linear-gradient(135deg, #fef08a, #eab308); }  /* 수 - 노랑 */
    .rainbow-3 { background: linear-gradient(135deg, #bbf7d0, #22c55e); }  /* 목 - 초록 */
    .rainbow-4 { background: linear-gradient(135deg, #bfdbfe, #3b82f6); }  /* 금 - 파랑 */
    .rainbow-5 { background: linear-gradient(135deg, #ddd6fe, #8b5cf6); }  /* 토 - 남색 */
    .rainbow-6 { background: linear-gradient(135deg, #f5d0fe, #ec4899); }  /* 일 - 보라 */

    /* 24시간 + 위/아래 여유 */
    .grid {
      display: grid;
      grid-template-columns: 80px repeat(7, 1fr);
      gap: 4px;
      height: calc(40px * 24 + 40px);
      border-radius: 0 0 10px 10px;
      overflow: hidden;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
    }

    .time-labels {
      position: relative;
      background-image: linear-gradient(to bottom, #e5e7eb 1px, transparent 1px);
      background-size: 100% 40px;
      padding-top: 8px; /* 00:00 안 잘리게 살짝 내리기 */
    }

    .time-label {
      position: absolute;
      left: 6px;
      font-size: 11px;
      color: #6b7280;
      transform: translateY(-50%);
    }

    .time-label.bottom {
      top: auto !important;
      bottom: 4px;
      transform: translateY(0);
    }

    .day-column {
      position: relative;
      background-image: linear-gradient(to bottom, #e5e7eb 1px, transparent 1px);
      background-size: 100% 40px;
      overflow: hidden;
      background-color: #fdfdfd;
      padding-top: 8px; /* 위쪽 약간 여유 */
    }

    .event {
      position: absolute;
      left: 4px;
      right: 4px;
      border-radius: 8px;
      padding: 4px 6px;
      font-size: 11px;
      line-height: 1.3;
      color: #111827;
      background: rgba(59, 130, 246, 0.15);
      border: 1px solid rgba(37, 99, 235, 0.35);
      box-shadow: 0 1px 3px rgba(15, 23, 42, 0.15);
      cursor: pointer;
      overflow: hidden;
    }

    .event:hover {
      filter: brightness(1.03);
      transform: translateY(-1px);
    }

    /* 파스텔 무지개 랜덤 색상들 */
    .event.color-0 { background: rgba(248, 113, 113, 0.18); border-color: rgba(239, 68, 68, 0.55); }
    .event.color-1 { background: rgba(251, 146, 60, 0.18);  border-color: rgba(249, 115, 22, 0.55); }
    .event.color-2 { background: rgba(250, 204, 21, 0.18);  border-color: rgba(234, 179, 8, 0.55); }
    .event.color-3 { background: rgba(52, 211, 153, 0.18);  border-color: rgba(16, 185, 129, 0.55); }
    .event.color-4 { background: rgba(59, 130, 246, 0.18);  border-color: rgba(37, 99, 235, 0.55); }
    .event.color-5 { background: rgba(129, 140, 248, 0.18); border-color: rgba(79, 70, 229, 0.55); }
    .event.color-6 { background: rgba(244, 114, 182, 0.18); border-color: rgba(236, 72, 153, 0.55); }

    .event-time {
      font-weight: 600;
      margin-bottom: 2px;
      font-size: 10px;
      color: #1f2933;
    }

    .event-title {
      font-size: 11px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .footer-tip {
      margin-top: 10px;
      font-size: 11px;
      color: #9ca3af;
      text-align: right;
    }

    .footer-tip span {
      font-weight: 600;
      color: #4b5563;
    }

    @media (max-width: 900px) {
      .app {
        margin: 0;
        border-radius: 0;
        box-shadow: none;
      }
    }
  </style>
</head>
<body>
<div class="app">
  <div class="app-title">스터디 플래너</div>
  <div class="app-subtitle">
    현재 주 기준으로 월~일 날짜가 자동 표시되고, 일정은 <strong>로컬 스토리지</strong>에 저장돼서 새로고침해도 유지돼요.
  </div>

  <div class="header-row">
    <div class="time-label-header">시간</div>

    <div class="day-header rainbow-0" data-day-index="0">
      <div class="day-header-inner">
        <button type="button" class="btn-add">+ 일정</button>
        <div class="day-center">
          <div class="label">월</div>
          <div class="date"></div>
        </div>
        <button type="button" class="btn-clear">초기화</button>
      </div>
    </div>

    <div class="day-header rainbow-1" data-day-index="1">
      <div class="day-header-inner">
        <button type="button" class="btn-add">+ 일정</button>
        <div class="day-center">
          <div class="label">화</div>
          <div class="date"></div>
        </div>
        <button type="button" class="btn-clear">초기화</button>
      </div>
    </div>

    <div class="day-header rainbow-2" data-day-index="2">
      <div class="day-header-inner">
        <button type="button" class="btn-add">+ 일정</button>
        <div class="day-center">
          <div class="label">수</div>
          <div class="date"></div>
        </div>
        <button type="button" class="btn-clear">초기화</button>
      </div>
    </div>

    <div class="day-header rainbow-3" data-day-index="3">
      <div class="day-header-inner">
        <button type="button" class="btn-add">+ 일정</button>
        <div class="day-center">
          <div class="label">목</div>
          <div class="date"></div>
        </div>
        <button type="button" class="btn-clear">초기화</button>
      </div>
    </div>

    <div class="day-header rainbow-4" data-day-index="4">
      <div class="day-header-inner">
        <button type="button" class="btn-add">+ 일정</button>
        <div class="day-center">
          <div class="label">금</div>
          <div class="date"></div>
        </div>
        <button type="button" class="btn-clear">초기화</button>
      </div>
    </div>

    <div class="day-header rainbow-5" data-day-index="5">
      <div class="day-header-inner">
        <button type="button" class="btn-add">+ 일정</button>
        <div class="day-center">
          <div class="label">토</div>
          <div class="date"></div>
        </div>
        <button type="button" class="btn-clear">초기화</button>
      </div>
    </div>

    <div class="day-header rainbow-6" data-day-index="6">
      <div class="day-header-inner">
        <button type="button" class="btn-add">+ 일정</button>
        <div class="day-center">
          <div class="label">일</div>
          <div class="date"></div>
        </div>
        <button type="button" class="btn-clear">초기화</button>
      </div>
    </div>
  </div>

  <div class="grid">
    <div class="time-labels" id="timeLabels"></div>
    <div class="day-column" data-day-index="0"></div>
    <div class="day-column" data-day-index="1"></div>
    <div class="day-column" data-day-index="2"></div>
    <div class="day-column" data-day-index="3"></div>
    <div class="day-column" data-day-index="4"></div>
    <div class="day-column" data-day-index="5"></div>
    <div class="day-column" data-day-index="6"></div>
  </div>

  <div class="footer-tip">
    일정 블록을 <span>클릭</span>하면 삭제할 수 있고, 각 요일의 <span>초기화</span> 버튼으로 모두 지울 수 있어요.
  </div>
</div>

<script>
  (function () {
    const STORAGE_KEY = "studyPlanner_v1";
    const HOUR_HEIGHT = 40;
    const EXTRA_BOTTOM = 40;
    const TOTAL_HEIGHT = HOUR_HEIGHT * 24 + EXTRA_BOTTOM;
    const COLOR_COUNT = 7;

    function loadData() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return { events: {} };
        const parsed = JSON.parse(raw);
        if (!parsed || typeof parsed !== "object") return { events: {} };
        if (!parsed.events || typeof parsed.events !== "object") parsed.events = {};
        return parsed;
      } catch (e) {
        console.error("loadData error", e);
        return { events: {} };
      }
    }

    function saveData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function zeroPad(num) {
      return num.toString().padStart(2, "0");
    }

    function formatDateKey(date) {
      return (
        date.getFullYear() +
        "-" +
        zeroPad(date.getMonth() + 1) +
        "-" +
        zeroPad(date.getDate())
      );
    }

    function formatMonthDay(date) {
      return (date.getMonth() + 1) + "/" + date.getDate();
    }

    function getMondayOfCurrentWeek() {
      const today = new Date();
      const day = today.getDay(); // 0=일, 1=월, ... 6=토
      const diffToMonday = (day + 6) % 7; // 월=0
      const monday = new Date(today);
      monday.setHours(0, 0, 0, 0);
      monday.setDate(monday.getDate() - diffToMonday);
      return monday;
    }

    // HH:MM 파싱 (24:00 허용)
    function parseTimeString(str) {
      if (!str) return null;
      str = str.trim();
      const m = /^(\d{1,2}):(\d{2})$/.exec(str);
      if (!m) return null;
      const hour = parseInt(m[1], 10);
      const minute = parseInt(m[2], 10);
      if (
        Number.isNaN(hour) ||
        Number.isNaN(minute) ||
        hour < 0 ||
        hour > 24 ||
        minute < 0 ||
        minute > 59
      ) {
        return null;
      }
      if (hour === 24 && minute !== 0) {
        return null;
      }
      return { hour, minute };
    }

    function minutesFromMidnight(timeStr) {
      const t = parseTimeString(timeStr);
      if (!t) return null;
      if (t.hour === 24 && t.minute === 0) {
        return 24 * 60;
      }
      return t.hour * 60 + t.minute;
    }

    function escapeHtml(str) {
      return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function createEventElement(event, dateKey) {
      const col = columnByDateKey[dateKey];
      if (!col) return;

      const startMinutes = minutesFromMidnight(event.start);
      const endMinutes = minutesFromMidnight(event.end);
      if (startMinutes == null || endMinutes == null) return;

      const duration = Math.max(endMinutes - startMinutes, 10);
      const top = (startMinutes / 60) * HOUR_HEIGHT;

      const el = document.createElement("div");
      el.className = "event";
      el.style.top = top + "px";
      el.style.height = (duration / 60) * HOUR_HEIGHT + "px";

      // 랜덤 파스텔 색 (기존 데이터에는 colorIndex가 없을 수 있음)
      if (typeof event.colorIndex === "number") {
        el.classList.add("color-" + event.colorIndex);
      }

      el.dataset.eventId = event.id;
      el.dataset.dateKey = dateKey;

      el.innerHTML =
        '<div class="event-time">' +
        escapeHtml(event.start) +
        " ~ " +
        escapeHtml(event.end) +
        "</div>" +
        '<div class="event-title">' +
        escapeHtml(event.title) +
        "</div>";

      el.addEventListener("click", function (e) {
        e.stopPropagation();
        const ok = confirm("이 일정을 삭제할까요?");
        if (!ok) return;
        deleteEvent(dateKey, event.id);
      });

      col.appendChild(el);
    }

    function clearRenderedEvents() {
      for (const dateKey in columnByDateKey) {
        const col = columnByDateKey[dateKey];
        if (!col) continue;
        const children = Array.from(col.querySelectorAll(".event"));
        children.forEach((c) => c.remove());
      }
    }

    function renderAllEvents() {
      clearRenderedEvents();
      for (const dateKey in columnByDateKey) {
        renderEventsForDate(dateKey);
      }
    }

    function renderEventsForDate(dateKey) {
      const col = columnByDateKey[dateKey];
      if (!col) return;
      const events = data.events[dateKey] || [];

      events.sort((a, b) => {
        const ma = minutesFromMidnight(a.start) ?? 0;
        const mb = minutesFromMidnight(b.start) ?? 0;
        return ma - mb;
      });

      const existing = Array.from(col.querySelectorAll(".event"));
      existing.forEach((e) => e.remove());

      events.forEach((ev) => createEventElement(ev, dateKey));
    }

    function addEvent(dateKey) {
      const title = prompt("할 일 / 메모를 입력하세요:");
      if (!title) return;

      const start = prompt("시작 시간을 입력하세요 (예: 08:40, 13:20):");
      if (!start) return;

      const end = prompt("끝나는 시간을 입력하세요 (예: 10:00, 15:20, 24:00):");
      if (!end) return;

      const startParsed = parseTimeString(start);
      const endParsed = parseTimeString(end);
      if (!startParsed || !endParsed) {
        alert("시간 형식이 잘못되었습니다. 예: 09:30 또는 24:00 처럼 입력해주세요.");
        return;
      }

      const startM = minutesFromMidnight(start);
      const endM = minutesFromMidnight(end);
      if (endM <= startM) {
        alert("끝나는 시간이 시작 시간보다 뒤여야 합니다.");
        return;
      }

      const colorIndex = Math.floor(Math.random() * COLOR_COUNT);

      const newEvent = {
        id: "e_" + Date.now() + "_" + Math.random().toString(16).slice(2),
        title: title.trim(),
        start: zeroPad(startParsed.hour) + ":" + zeroPad(startParsed.minute),
        end: zeroPad(endParsed.hour) + ":" + zeroPad(endParsed.minute),
        colorIndex: colorIndex
      };

      if (!data.events[dateKey]) data.events[dateKey] = [];
      data.events[dateKey].push(newEvent);
      saveData();
      renderEventsForDate(dateKey);
    }

    function deleteEvent(dateKey, eventId) {
      if (!data.events[dateKey]) return;
      data.events[dateKey] = data.events[dateKey].filter(function (ev) {
        return ev.id !== eventId;
      });
      saveData();
      renderEventsForDate(dateKey);
    }

    function clearDay(dateKey) {
      const ok = confirm("이 날짜의 모든 일정을 삭제할까요?");
      if (!ok) return;
      data.events[dateKey] = [];
      saveData();
      renderEventsForDate(dateKey);
    }

    // ---- 초기 세팅 ----
    const data = loadData();

    const headerEls = document.querySelectorAll(".day-header");
    const columnEls = document.querySelectorAll(".day-column");
    const timeLabelsContainer = document.getElementById("timeLabels");

    const monday = getMondayOfCurrentWeek();
    const dateKeyByDayIndex = {};
    const columnByDateKey = {};

    headerEls.forEach(function (headerEl) {
      const dayIndex = parseInt(headerEl.dataset.dayIndex, 10);
      const date = new Date(monday);
      date.setDate(monday.getDate() + dayIndex);

      const dateKey = formatDateKey(date);
      dateKeyByDayIndex[dayIndex] = dateKey;
      headerEl.dataset.dateKey = dateKey;

      const dateEl = headerEl.querySelector(".date");
      if (dateEl) {
        dateEl.textContent = formatMonthDay(date);
      }

      const addBtn = headerEl.querySelector(".btn-add");
      if (addBtn) {
        addBtn.addEventListener("click", function () {
          addEvent(dateKey);
        });
      }

      const clearBtn = headerEl.querySelector(".btn-clear");
      if (clearBtn) {
        clearBtn.addEventListener("click", function () {
          clearDay(dateKey);
        });
      }
    });

    columnEls.forEach(function (col) {
      const dayIndex = parseInt(col.dataset.dayIndex, 10);
      const dateKey = dateKeyByDayIndex[dayIndex];
      col.dataset.dateKey = dateKey;
      columnByDateKey[dateKey] = col;
    });

    // 왼쪽 시간 라벨 (00:00 ~ 23:00 + 맨 아래 24:00)
    (function renderTimeLabels() {
      timeLabelsContainer.style.height = TOTAL_HEIGHT + "px";
      for (let h = 0; h < 24; h++) {
        const label = document.createElement("div");
        label.className = "time-label";
        label.style.top = (8 + h * HOUR_HEIGHT) + "px"; // padding-top 8 고려
        label.textContent = zeroPad(h) + ":00";
        timeLabelsContainer.appendChild(label);
      }
      const last = document.createElement("div");
      last.className = "time-label bottom";
      last.textContent = "24:00";
      timeLabelsContainer.appendChild(last);
    })();

    // 초기 이벤트 렌더링
    renderAllEvents();
  })();
</script>
</body>
</html>
