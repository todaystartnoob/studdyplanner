<!DOCTYPE html>
<html lang="ko">
<head>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" />
  <link rel="icon" type="image/png" href="studyplanner-removebg-preview.png">
  <meta charset="UTF-8" />
  <title>ìŠ¤í„°ë”” í”Œë˜ë„ˆ</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, system-ui, Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
      background: #f3f4f6;
    }

    .app {
      max-width: 1200px;
      margin: 20px auto;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
      padding: 16px 16px 24px;
    }

    .app-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .app-subtitle {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 16px;
    }

    .header-row {
      display: grid;
      grid-template-columns: 80px repeat(7, 1fr);
      gap: 4px;
      align-items: stretch;
      margin-bottom: 4px;
    }

    .time-label-header {
      text-align: center;
      font-weight: 600;
      font-size: 13px;
      padding: 8px 4px;
      color: #374151;
    }

    .day-header {
      position: relative;
      padding: 6px 6px 8px;
      border-radius: 10px 10px 0 0;
      color: #111827;
      font-weight: 600;
      font-size: 13px;
      min-height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .day-header-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      gap: 4px;
    }

    .day-center {
      flex: 1;
      text-align: center;
      line-height: 1.2;
    }

    .day-center .label {
      font-size: 14px;
      margin-bottom: 2px;
    }

    .day-center .date {
      font-size: 11px;
      opacity: 0.9;
    }

    .day-header button {
      border: none;
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 11px;
      cursor: pointer;
      background: rgba(255, 255, 255, 0.9);
      color: #111827;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
      white-space: nowrap;
    }

    .day-header button:hover {
      background: #ffffff;
      transform: translateY(-1px);
    }

    .btn-clear {
      background: rgba(248, 250, 252, 0.9);
      color: #b91c1c;
    }

    /* ë¬´ì§€ê°œ ìƒ‰ ìš”ì¼ */
    .rainbow-0 { background: linear-gradient(135deg, #fecaca, #f97373); }  /* ì›” - ë¹¨ê°• */
    .rainbow-1 { background: linear-gradient(135deg, #fed7aa, #fb923c); }  /* í™” - ì£¼í™© */
    .rainbow-2 { background: linear-gradient(135deg, #fef08a, #eab308); }  /* ìˆ˜ - ë…¸ë‘ */
    .rainbow-3 { background: linear-gradient(135deg, #bbf7d0, #22c55e); }  /* ëª© - ì´ˆë¡ */
    .rainbow-4 { background: linear-gradient(135deg, #bfdbfe, #3b82f6); }  /* ê¸ˆ - íŒŒë‘ */
    .rainbow-5 { background: linear-gradient(135deg, #ddd6fe, #8b5cf6); }  /* í†  - ë‚¨ìƒ‰ */
    .rainbow-6 { background: linear-gradient(135deg, #f5d0fe, #ec4899); }  /* ì¼ - ë³´ë¼ */

    /* 24ì‹œê°„ + ìœ„/ì•„ë˜ ì—¬ìœ  */
    .grid {
      display: grid;
      grid-template-columns: 80px repeat(7, 1fr);
      gap: 4px;
      height: calc(40px * 24 + 40px);
      border-radius: 0 0 10px 10px;
      overflow: hidden;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
    }

    .time-labels {
      position: relative;
      background-image: linear-gradient(to bottom, #e5e7eb 1px, transparent 1px);
      background-size: 100% 40px;
      padding-top: 8px; /* 00:00 ì•ˆ ì˜ë¦¬ê²Œ ì‚´ì§ ë‚´ë¦¬ê¸° */
    }

    .time-label {
      position: absolute;
      left: 6px;
      font-size: 11px;
      color: #6b7280;
      transform: translateY(-50%);
    }

    .time-label.bottom {
      top: auto !important;
      bottom: 4px;
      transform: translateY(0);
    }

    .day-column {
      position: relative;
      background-image: linear-gradient(to bottom, #e5e7eb 1px, transparent 1px);
      background-size: 100% 40px;
      overflow: hidden;
      background-color: #fdfdfd;
      padding-top: 8px; /* ìœ„ìª½ ì•½ê°„ ì—¬ìœ  */
    }

    .event {
      position: absolute;
      left: 4px;
      right: 4px;
      border-radius: 8px;
      padding: 4px 6px;
      font-size: 11px;
      line-height: 1.3;
      color: #111827;
      background: rgba(59, 130, 246, 0.15);
      border: 1px solid rgba(37, 99, 235, 0.35);
      box-shadow: 0 1px 3px rgba(15, 23, 42, 0.15);
      cursor: pointer;
      overflow: hidden;
    }

    .event:hover {
      filter: brightness(1.03);
      transform: translateY(-1px);
    }

    /* íŒŒìŠ¤í…” ë¬´ì§€ê°œ ëœë¤ ìƒ‰ìƒë“¤ */
    .event.color-0 { background: rgba(248, 113, 113, 0.18); border-color: rgba(239, 68, 68, 0.55); }
    .event.color-1 { background: rgba(251, 146, 60, 0.18);  border-color: rgba(249, 115, 22, 0.55); }
    .event.color-2 { background: rgba(250, 204, 21, 0.18);  border-color: rgba(234, 179, 8, 0.55); }
    .event.color-3 { background: rgba(52, 211, 153, 0.18);  border-color: rgba(16, 185, 129, 0.55); }
    .event.color-4 { background: rgba(59, 130, 246, 0.18);  border-color: rgba(37, 99, 235, 0.55); }
    .event.color-5 { background: rgba(129, 140, 248, 0.18); border-color: rgba(79, 70, 229, 0.55); }
    .event.color-6 { background: rgba(244, 114, 182, 0.18); border-color: rgba(236, 72, 153, 0.55); }

    .event-time {
      font-weight: 600;
      margin-bottom: 2px;
      font-size: 10px;
      color: #1f2933;
    }

    .event-title {
      font-size: 11px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .footer-tip {
      margin-top: 10px;
      font-size: 11px;
      color: #9ca3af;
      text-align: right;
    }

    .footer-tip span {
      font-weight: 600;
      color: #4b5563;
    }

    @media (max-width: 900px) {
      .app {
        margin: 0;
        border-radius: 0;
        box-shadow: none;
      }
    }
  </style>
</head>
<body>
<div class="app">
  <div class="app-title">ìŠ¤í„°ë”” í”Œë˜ë„ˆ</div>
  <div class="app-subtitle">
    í˜„ì¬ ì£¼ ê¸°ì¤€ìœ¼ë¡œ ì›”~ì¼ ë‚ ì§œê°€ ìë™ í‘œì‹œë˜ê³ , ì¼ì •ì€ <strong>ë¡œì»¬ ìŠ¤í† ë¦¬ì§€</strong>ì— ì €ì¥ë¼ì„œ ìƒˆë¡œê³ ì¹¨í•´ë„ ìœ ì§€ë¼ìš”.
  </div>

  <div style="display:flex; gap:8px; margin-bottom:12px;">
    <button onclick="exportJSON()">ğŸ“¤ JSON ë‚´ë³´ë‚´ê¸°</button>
    <label style="cursor:pointer;">
      ğŸ“¥ JSON ë¶ˆëŸ¬ì˜¤ê¸°
      <input type="file" accept=".json" onchange="importJSON(this)" hidden>
    </label>
    <button onclick="exportPNG()">ğŸ–¼ PNG ì €ì¥</button>
  </div>
  

  <div class="header-row">
    <div class="time-label-header">ì‹œê°„</div>

    <div class="day-header rainbow-0" data-day-index="0">
      <div class="day-header-inner">
        <button type="button" class="btn-add">+ ì¼ì •</button>
        <div class="day-center">
          <div class="label">ì›”</div>
          <div class="date"></div>
        </div>
        <button type="button" class="btn-clear">ì´ˆê¸°í™”</button>
      </div>
    </div>

    <div class="day-header rainbow-1" data-day-index="1">
      <div class="day-header-inner">
        <button type="button" class="btn-add">+ ì¼ì •</button>
        <div class="day-center">
          <div class="label">í™”</div>
          <div class="date"></div>
        </div>
        <button type="button" class="btn-clear">ì´ˆê¸°í™”</button>
      </div>
    </div>

    <div class="day-header rainbow-2" data-day-index="2">
      <div class="day-header-inner">
        <button type="button" class="btn-add">+ ì¼ì •</button>
        <div class="day-center">
          <div class="label">ìˆ˜</div>
          <div class="date"></div>
        </div>
        <button type="button" class="btn-clear">ì´ˆê¸°í™”</button>
      </div>
    </div>

    <div class="day-header rainbow-3" data-day-index="3">
      <div class="day-header-inner">
        <button type="button" class="btn-add">+ ì¼ì •</button>
        <div class="day-center">
          <div class="label">ëª©</div>
          <div class="date"></div>
        </div>
        <button type="button" class="btn-clear">ì´ˆê¸°í™”</button>
      </div>
    </div>

    <div class="day-header rainbow-4" data-day-index="4">
      <div class="day-header-inner">
        <button type="button" class="btn-add">+ ì¼ì •</button>
        <div class="day-center">
          <div class="label">ê¸ˆ</div>
          <div class="date"></div>
        </div>
        <button type="button" class="btn-clear">ì´ˆê¸°í™”</button>
      </div>
    </div>

    <div class="day-header rainbow-5" data-day-index="5">
      <div class="day-header-inner">
        <button type="button" class="btn-add">+ ì¼ì •</button>
        <div class="day-center">
          <div class="label">í† </div>
          <div class="date"></div>
        </div>
        <button type="button" class="btn-clear">ì´ˆê¸°í™”</button>
      </div>
    </div>

    <div class="day-header rainbow-6" data-day-index="6">
      <div class="day-header-inner">
        <button type="button" class="btn-add">+ ì¼ì •</button>
        <div class="day-center">
          <div class="label">ì¼</div>
          <div class="date"></div>
        </div>
        <button type="button" class="btn-clear">ì´ˆê¸°í™”</button>
      </div>
    </div>
  </div>

  <div class="grid">
    <div class="time-labels" id="timeLabels"></div>
    <div class="day-column" data-day-index="0"></div>
    <div class="day-column" data-day-index="1"></div>
    <div class="day-column" data-day-index="2"></div>
    <div class="day-column" data-day-index="3"></div>
    <div class="day-column" data-day-index="4"></div>
    <div class="day-column" data-day-index="5"></div>
    <div class="day-column" data-day-index="6"></div>
  </div>

  <div class="footer-tip">
    ì¼ì • ë¸”ë¡ì„ <span>í´ë¦­</span>í•˜ë©´ ì‚­ì œ, <span>ìš°í´ë¦­</span>í•˜ë©´ ë‚´ìš© ìˆ˜ì •í•  ìˆ˜ ìˆê³ ,<br>
    ê° ìš”ì¼ì˜ <span>ì´ˆê¸°í™”</span> ë²„íŠ¼ìœ¼ë¡œ ëª¨ë‘ ì§€ìš¸ ìˆ˜ ìˆì–´ìš”.
  </div>
</div>

<script>
  (function () {
    const STORAGE_KEY = "studyPlanner_v1";
    const HOUR_HEIGHT = 40;
    const EXTRA_BOTTOM = 40;
    const TOTAL_HEIGHT = HOUR_HEIGHT * 24 + EXTRA_BOTTOM;
    const COLOR_COUNT = 7;

    // ===== ì•Œë¦¼ ì‚¬ìš´ë“œ ê´€ë ¨ =====
    const alertSound = new Audio("alert.mp3"); // ê°™ì€ í´ë”ì— alert.mp3 ë„£ê¸°
    alertSound.volume = 1.0;
    let audioUnlocked = false;

    function playAlert() {
      if (!audioUnlocked) return;
      try {
        alertSound.currentTime = 0;
        alertSound.play().catch(() => {});
      } catch (e) {
        console.error(e);
      }
    }

    // ì‚¬ìš©ì ì²« í´ë¦­ ì‹œ ì˜¤ë””ì˜¤ ì‚¬ìš© í—ˆìš©
    document.addEventListener(
      "click",
      function unlockAudio() {
        audioUnlocked = true;
        alertSound.play().catch(() => {});
        document.removeEventListener("click", unlockAudio);
      },
      { once: true }
    );

    function loadData() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return { events: {} };
        const parsed = JSON.parse(raw);
        if (!parsed || typeof parsed !== "object") return { events: {} };
        if (!parsed.events || typeof parsed.events !== "object") parsed.events = {};
        return parsed;
      } catch (e) {
        console.error("loadData error", e);
        return { events: {} };
      }
    }

    function saveData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function zeroPad(num) {
      return num.toString().padStart(2, "0");
    }

    function formatDateKey(date) {
      return (
        date.getFullYear() +
        "-" +
        zeroPad(date.getMonth() + 1) +
        "-" +
        zeroPad(date.getDate())
      );
    }

    function formatMonthDay(date) {
      return (date.getMonth() + 1) + "/" + date.getDate();
    }

    function getMondayOfCurrentWeek() {
      const today = new Date();
      const day = today.getDay(); // 0=ì¼, 1=ì›”, ... 6=í† 
      const diffToMonday = (day + 6) % 7; // ì›”=0
      const monday = new Date(today);
      monday.setHours(0, 0, 0, 0);
      monday.setDate(monday.getDate() - diffToMonday);
      return monday;
    }

    // HH:MM íŒŒì‹± (24:00 í—ˆìš©)
    function parseTimeString(str) {
      if (!str) return null;
      str = str.trim();
      const m = /^(\d{1,2}):(\d{2})$/.exec(str);
      if (!m) return null;
      const hour = parseInt(m[1], 10);
      const minute = parseInt(m[2], 10);
      if (
        Number.isNaN(hour) ||
        Number.isNaN(minute) ||
        hour < 0 ||
        hour > 24 ||
        minute < 0 ||
        minute > 59
      ) {
        return null;
      }
      if (hour === 24 && minute !== 0) {
        return null;
      }
      return { hour, minute };
    }

    function minutesFromMidnight(timeStr) {
      const t = parseTimeString(timeStr);
      if (!t) return null;
      if (t.hour === 24 && t.minute === 0) {
        return 24 * 60;
      }
      return t.hour * 60 + t.minute;
    }

    function escapeHtml(str) {
      return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function createEventElement(event, dateKey) {
      const col = columnByDateKey[dateKey];
      if (!col) return;

      const startMinutes = minutesFromMidnight(event.start);
      const endMinutes = minutesFromMidnight(event.end);
      if (startMinutes == null || endMinutes == null) return;

      const duration = Math.max(endMinutes - startMinutes, 10);
      const top = (startMinutes / 60) * HOUR_HEIGHT;

      const el = document.createElement("div");
      el.className = "event";
      el.style.top = top + "px";
      el.style.height = (duration / 60) * HOUR_HEIGHT + "px";

      // ëœë¤ íŒŒìŠ¤í…” ìƒ‰ (ê¸°ì¡´ ë°ì´í„°ì—ëŠ” colorIndexê°€ ì—†ì„ ìˆ˜ ìˆìŒ)
      if (typeof event.colorIndex === "number") {
        el.classList.add("color-" + event.colorIndex);
      }

      el.dataset.eventId = event.id;
      el.dataset.dateKey = dateKey;

      el.innerHTML =
        '<div class="event-time">' +
        escapeHtml(event.start) +
        " ~ " +
        escapeHtml(event.end) +
        "</div>" +
        '<div class="event-title">' +
        escapeHtml(event.title) +
        "</div>";

      // ì¢Œí´ë¦­ â†’ ì‚­ì œ
      el.addEventListener("click", function (e) {
        e.stopPropagation();
        const ok = confirm("ì´ ì¼ì •ì„ ì‚­ì œí• ê¹Œìš”?");
        if (!ok) return;
        deleteEvent(dateKey, event.id);
      });

      // ìš°í´ë¦­ â†’ ë‚´ìš© ìˆ˜ì • (ì‹œê°„ì€ ê·¸ëŒ€ë¡œ)
      el.addEventListener("contextmenu", function (e) {
        e.preventDefault();
        const newTitle = prompt("ë‚´ìš©ì„ ìˆ˜ì •í•˜ì„¸ìš”:", event.title);
        if (newTitle === null) return; // ì·¨ì†Œ
        const trimmed = newTitle.trim();
        if (!trimmed) return;
        event.title = trimmed;
        saveData();
        renderEventsForDate(dateKey);
      });

      col.appendChild(el);
    }
    // ===== JSON ë‚´ë³´ë‚´ê¸° =====
    function exportJSON() {
      const result = [];

      for (const dateKey in data.events) {
        data.events[dateKey].forEach(ev => {
          result.push({
            date: dateKey,
            title: ev.title,
            start: ev.start,
            end: ev.end,
            colorIndex: ev.colorIndex ?? 0
          });
        });
      }

      const blob = new Blob([JSON.stringify(result, null, 2)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "planner.json";
      a.click();
    }

    // ===== JSON ë¶ˆëŸ¬ì˜¤ê¸° =====
    function importJSON(input) {
      const file = input.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = e => {
        try {
          const json = JSON.parse(e.target.result);
          if (!Array.isArray(json)) throw new Error();

          data.events = {};

          json.forEach(item => {
            if (!data.events[item.date]) data.events[item.date] = [];
            data.events[item.date].push({
              id: "e_" + Math.random().toString(36).slice(2),
              title: item.title,
              start: item.start,
              end: item.end,
              colorIndex: item.colorIndex ?? 0,
              alarmStartDone: false,
              alarmEndDone: false
            });
          });

          saveData();
          renderAllEvents();
          alert("JSON ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ!");
        } catch {
          alert("ì˜ëª»ëœ JSON íŒŒì¼ì…ë‹ˆë‹¤.");
        }
      };
      reader.readAsText(file);
    }

    // ===== PNGë¡œ ì €ì¥ =====
    function exportPNG() {
      const target = document.querySelector(".app");
      html2canvas(target, { scale: 2 }).then(canvas => {
        const a = document.createElement("a");
        a.href = canvas.toDataURL("image/png");
        a.download = "planner.png";
        a.click();
      });
    }



    function clearRenderedEvents() {
      for (const dateKey in columnByDateKey) {
        const col = columnByDateKey[dateKey];
        if (!col) continue;
        const children = Array.from(col.querySelectorAll(".event"));
        children.forEach((c) => c.remove());
      }
    }

    function renderAllEvents() {
      clearRenderedEvents();
      for (const dateKey in columnByDateKey) {
        renderEventsForDate(dateKey);
      }
    }

    function renderEventsForDate(dateKey) {
      const col = columnByDateKey[dateKey];
      if (!col) return;
      const events = data.events[dateKey] || [];

      events.sort((a, b) => {
        const ma = minutesFromMidnight(a.start) ?? 0;
        const mb = minutesFromMidnight(b.start) ?? 0;
        return ma - mb;
      });

      const existing = Array.from(col.querySelectorAll(".event"));
      existing.forEach((e) => e.remove());

      events.forEach((ev) => createEventElement(ev, dateKey));
    }

    function addEvent(dateKey) {
      const title = prompt("í•  ì¼ / ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
      if (!title) return;

      const start = prompt("ì‹œì‘ ì‹œê°„ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 08:40, 13:20):");
      if (!start) return;

      const end = prompt("ëë‚˜ëŠ” ì‹œê°„ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 10:00, 15:20, 24:00):");
      if (!end) return;

      const startParsed = parseTimeString(start);
      const endParsed = parseTimeString(end);
      if (!startParsed || !endParsed) {
        alert("ì‹œê°„ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤. ì˜ˆ: 09:30 ë˜ëŠ” 24:00 ì²˜ëŸ¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      const startM = minutesFromMidnight(start);
      const endM = minutesFromMidnight(end);
      if (endM <= startM) {
        alert("ëë‚˜ëŠ” ì‹œê°„ì´ ì‹œì‘ ì‹œê°„ë³´ë‹¤ ë’¤ì—¬ì•¼ í•©ë‹ˆë‹¤.");
        return;
      }

      const colorIndex = Math.floor(Math.random() * COLOR_COUNT);

      const newEvent = {
        id: "e_" + Date.now() + "_" + Math.random().toString(16).slice(2),
        title: title.trim(),
        start: zeroPad(startParsed.hour) + ":" + zeroPad(startParsed.minute),
        end: zeroPad(endParsed.hour) + ":" + zeroPad(endParsed.minute),
        colorIndex: colorIndex,
        alarmStartDone: false,
        alarmEndDone: false
      };

      if (!data.events[dateKey]) data.events[dateKey] = [];
      data.events[dateKey].push(newEvent);
      saveData();
      renderEventsForDate(dateKey);
    }

    function deleteEvent(dateKey, eventId) {
      if (!data.events[dateKey]) return;
      data.events[dateKey] = data.events[dateKey].filter(function (ev) {
        return ev.id !== eventId;
      });
      saveData();
      renderEventsForDate(dateKey);
    }

    function clearDay(dateKey) {
      const ok = confirm("ì´ ë‚ ì§œì˜ ëª¨ë“  ì¼ì •ì„ ì‚­ì œí• ê¹Œìš”?");
      if (!ok) return;
      data.events[dateKey] = [];
      saveData();
      renderEventsForDate(dateKey);
    }

    // ---- ì´ˆê¸° ì„¸íŒ… ----
    const data = loadData();

    const headerEls = document.querySelectorAll(".day-header");
    const columnEls = document.querySelectorAll(".day-column");
    const timeLabelsContainer = document.getElementById("timeLabels");

    const monday = getMondayOfCurrentWeek();
    const dateKeyByDayIndex = {};
    const columnByDateKey = {};

    headerEls.forEach(function (headerEl) {
      const dayIndex = parseInt(headerEl.dataset.dayIndex, 10);
      const date = new Date(monday);
      date.setDate(monday.getDate() + dayIndex);

      const dateKey = formatDateKey(date);
      dateKeyByDayIndex[dayIndex] = dateKey;
      headerEl.dataset.dateKey = dateKey;

      const dateEl = headerEl.querySelector(".date");
      if (dateEl) {
        dateEl.textContent = formatMonthDay(date);
      }

      const addBtn = headerEl.querySelector(".btn-add");
      if (addBtn) {
        addBtn.addEventListener("click", function () {
          addEvent(dateKey);
        });
      }

      const clearBtn = headerEl.querySelector(".btn-clear");
      if (clearBtn) {
        clearBtn.addEventListener("click", function () {
          clearDay(dateKey);
        });
      }
    });

    columnEls.forEach(function (col) {
      const dayIndex = parseInt(col.dataset.dayIndex, 10);
      const dateKey = dateKeyByDayIndex[dayIndex];
      col.dataset.dateKey = dateKey;
      columnByDateKey[dateKey] = col;
    });

    // ì™¼ìª½ ì‹œê°„ ë¼ë²¨ (00:00 ~ 23:00 + ë§¨ ì•„ë˜ 24:00)
    (function renderTimeLabels() {
      timeLabelsContainer.style.height = TOTAL_HEIGHT + "px";
      for (let h = 0; h < 24; h++) {
        const label = document.createElement("div");
        label.className = "time-label";
        label.style.top = (8 + h * HOUR_HEIGHT) + "px"; // padding-top 8 ê³ ë ¤
        label.textContent = zeroPad(h) + ":00";
        timeLabelsContainer.appendChild(label);
      }
      const last = document.createElement("div");
      last.className = "time-label bottom";
      last.textContent = "24:00";
      timeLabelsContainer.appendChild(last);
    })();

    // ===== ì¼ì • ì•Œë¦¼ ì²´í¬ =====
    let lastCheckedMinute = null;

    function checkSchedules() {
      const now = new Date();
      const hh = zeroPad(now.getHours());
      const mm = zeroPad(now.getMinutes());
      const currentMinute = `${hh}:${mm}`;

      // ê°™ì€ ë¶„ì—ëŠ” í•œ ë²ˆë§Œ ì²˜ë¦¬
      if (currentMinute === lastCheckedMinute) return;
      lastCheckedMinute = currentMinute;

      for (const dateKey in data.events) {
        const events = data.events[dateKey] || [];

        for (const event of events) {

          // ì‹œì‘ ì•ŒëŒ
          if (event.start === currentMinute && !event.alarmStartDone) {
            playAlert();
            event.alarmStartDone = true;
          }

          // ë ì•ŒëŒ
          if (event.end === currentMinute && !event.alarmEndDone) {
            playAlert();
            event.alarmEndDone = true;
          }
        }
      }

      saveData();
    }


    // 10ì´ˆë§ˆë‹¤ ì²´í¬ (ë¶„ ë‹¨ìœ„ë§Œ ë¹„êµí•˜ë¯€ë¡œ ì‹¤ì œ ìš¸ë¦¬ëŠ” ê±´ ë¶„ë‹¹ 1ë²ˆì”©ë§Œ ê°€ëŠ¥)
    setInterval(checkSchedules, 1000);
    checkSchedules();

    // ì´ˆê¸° ì´ë²¤íŠ¸ ë Œë”ë§
    renderAllEvents();
  })();
</script>
</body>
</html>
